{{/* Podcast player partial - Audio és/vagy YouTube támogatással */}}

{{ if or .Params.audioFile .Params.youtube }}
<div class="media-player">

  {{/* YouTube embed */}}
  {{ if .Params.youtube }}
  <div class="video-container">
    {{ $ytID := .Params.youtube }}
    {{/* Ha teljes URL van megadva, kinyerjük az ID-t */}}
    {{ if strings.Contains $ytID "youtube.com" }}
      {{ $ytID = index (split (index (split $ytID "v=") 1) "&") 0 }}
    {{ else if strings.Contains $ytID "youtu.be" }}
      {{ $ytID = index (split $ytID "/") (sub (len (split $ytID "/")) 1) }}
    {{ end }}
    <iframe 
      src="https://www.youtube-nocookie.com/embed/{{ $ytID }}" 
      title="{{ .Title }}"
      frameborder="0" 
      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
      allowfullscreen>
    </iframe>
  </div>
  {{ end }}

  {{/* Vimeo embed */}}
  {{ if .Params.vimeo }}
  <div class="video-container">
    <iframe 
      src="https://player.vimeo.com/video/{{ .Params.vimeo }}?dnt=1" 
      title="{{ .Title }}"
      frameborder="0" 
      allow="autoplay; fullscreen; picture-in-picture" 
      allowfullscreen>
    </iframe>
  </div>
  {{ end }}

  {{/* Audio player */}}
  {{ if .Params.audioFile }}
  <div class="podcast-player">
    <div class="player-container">
      {{ $audioSrc := .Params.audioFile }}
      {{/* Ha csak fájlnév van, /audio/ prefix hozzáadása */}}
      {{ if not (strings.HasPrefix $audioSrc "/") }}
        {{ if not (strings.HasPrefix $audioSrc "http") }}
          {{ $audioSrc = printf "/audio/%s" $audioSrc }}
        {{ end }}
      {{ end }}
      
      <audio id="audio-player" preload="metadata">
        <source src="{{ $audioSrc }}" type="audio/mpeg">
        A böngésződ nem támogatja az audio lejátszást.
      </audio>
      
      <div class="player-controls">
        <button id="play-pause" class="play-button" aria-label="Play/Pause">
          <svg class="play-icon" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
            <path d="M8 5v14l11-7z"/>
          </svg>
          <svg class="pause-icon" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" style="display:none;">
            <path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z"/>
          </svg>
        </button>
        
        <div class="time-display">
          <span id="current-time">0:00</span>
        </div>
        
        <div class="progress-container">
          <input type="range" id="progress-bar" class="progress-bar" min="0" max="100" value="0" step="0.1">
        </div>
        
        <div class="duration-display">
          <span id="duration">{{ if .Params.duration }}{{ .Params.duration }}{{ else }}0:00{{ end }}</span>
        </div>
        
        <div class="volume-control">
          <button id="mute-button" class="volume-button" aria-label="Mute/Unmute">
            <svg class="volume-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/>
              <path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"/>
            </svg>
            <svg class="mute-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display:none;">
              <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/>
              <line x1="23" y1="9" x2="17" y2="15"/>
              <line x1="17" y1="9" x2="23" y2="15"/>
            </svg>
          </button>
          <input type="range" id="volume-slider" class="volume-slider" min="0" max="100" value="100">
        </div>
        
        {{/* Letöltés gomb */}}
        <a href="{{ $audioSrc }}" download class="download-button" aria-label="Letöltés" title="Epizód letöltése">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
            <polyline points="7 10 12 15 17 10"/>
            <line x1="12" y1="15" x2="12" y2="3"/>
          </svg>
        </a>
      </div>
    </div>
  </div>
  {{ end }}

</div>

<style>
  .media-player {
    margin: 2rem 0;
  }
  
  .video-container {
    position: relative;
    padding-bottom: 56.25%; /* 16:9 */
    height: 0;
    overflow: hidden;
    margin-bottom: 1.5rem;
    border-radius: 8px;
    background: var(--bg-secondary);
  }
  
  .video-container iframe {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border-radius: 8px;
  }
  
  .download-button {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0.5rem;
    color: var(--text-secondary);
    transition: color 0.2s;
  }
  
  .download-button:hover {
    color: var(--color-olive);
  }
</style>

<script>
(function() {
  const audio = document.getElementById('audio-player');
  if (!audio) return;
  
  const playPauseBtn = document.getElementById('play-pause');
  const playIcon = document.querySelector('.play-icon');
  const pauseIcon = document.querySelector('.pause-icon');
  const progressBar = document.getElementById('progress-bar');
  const currentTimeDisplay = document.getElementById('current-time');
  const durationDisplay = document.getElementById('duration');
  const muteBtn = document.getElementById('mute-button');
  const volumeIcon = document.querySelector('.volume-icon');
  const muteIcon = document.querySelector('.mute-icon');
  const volumeSlider = document.getElementById('volume-slider');
  
  function formatTime(seconds) {
    const mins = Math.floor(seconds / 60);
    const secs = Math.floor(seconds % 60);
    return `${mins}:${secs.toString().padStart(2, '0')}`;
  }
  
  playPauseBtn.addEventListener('click', () => {
    if (audio.paused) {
      audio.play();
      playIcon.style.display = 'none';
      pauseIcon.style.display = 'block';
    } else {
      audio.pause();
      playIcon.style.display = 'block';
      pauseIcon.style.display = 'none';
    }
  });
  
  audio.addEventListener('timeupdate', () => {
    const progress = (audio.currentTime / audio.duration) * 100;
    progressBar.value = progress || 0;
    currentTimeDisplay.textContent = formatTime(audio.currentTime);
  });
  
  audio.addEventListener('loadedmetadata', () => {
    durationDisplay.textContent = formatTime(audio.duration);
  });
  
  progressBar.addEventListener('input', () => {
    const time = (progressBar.value / 100) * audio.duration;
    audio.currentTime = time;
  });
  
  muteBtn.addEventListener('click', () => {
    audio.muted = !audio.muted;
    volumeIcon.style.display = audio.muted ? 'none' : 'block';
    muteIcon.style.display = audio.muted ? 'block' : 'none';
  });
  
  volumeSlider.addEventListener('input', () => {
    audio.volume = volumeSlider.value / 100;
  });
})();
</script>
{{ end }}
